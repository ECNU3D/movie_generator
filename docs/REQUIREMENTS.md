# AI电影生成器 - 需求与设计文档

## 1. 项目概述

### 1.1 项目目标
构建一个开源的AI电影生成器，实现从剧本创作到视频成片的完整工作流程，支持多平台API接入，让用户能够灵活选择不同的AI服务提供商。

### 1.2 核心工作流程
```
剧本生成 → 角色设计 → 分镜生成 → 故事板生成 → 视频生成 → 后期合成
```

### 1.3 参考产品
- [Elser AI](https://www.elser.ai/zh/home) - 主要参考其完整工作流程

---

## 2. 功能需求

### 2.1 剧本模块

#### 2.1.1 剧本生成
- AI辅助生成剧本（支持多种LLM）
- 支持长剧本（最终成片可达1小时）
- 剧本结构化：场景、对话、动作描述、镜头指示

#### 2.1.2 剧本编辑器
- 富文本编辑功能
- 场景分割与管理
- 角色对话高亮
- 版本历史管理
- 导入/导出功能（Final Draft、Fountain等格式）

### 2.2 角色模块

#### 2.2.1 角色设计
- AI生成角色设定图
- 多角度参考图生成（正面、侧面、背面等）
- 角色属性管理（姓名、外貌描述、性格等）
- 角色库管理

#### 2.2.2 角色一致性方案
| 方案 | 成本 | 效果 | 支持平台 |
|------|------|------|----------|
| 主体参考 | 高 | 好 | 部分平台支持 |
| 提示词控制 | 低 | 中等 | 所有平台 |
| 混合方案 | 中 | 较好 | 灵活配置 |

### 2.3 分镜模块

#### 2.3.1 分镜生成
- 根据剧本自动拆分场景
- AI生成分镜描述
- 分镜图片生成（文生图）

#### 2.3.2 分镜管理
- 分镜顺序调整
- 分镜时长设置
- 镜头运动标注（推、拉、摇、移等）
- 转场效果设置

### 2.4 视频生成模块

#### 2.4.1 支持的生成模式
1. **图生视频**：提供首帧/首尾帧 + 提示词
2. **文生视频**：仅提供提示词
3. **主体参考**：上传角色参考图保持一致性

#### 2.4.2 视频参数
- 分辨率选择
- 时长控制
- 帧率设置
- 风格选择

### 2.5 素材管理模块
- 图片素材库
- 视频片段库
- 音频素材库
- 标签与分类
- 搜索与筛选

### 2.6 项目管理模块
- 项目创建与管理
- 多项目切换
- 项目导出/备份
- 协作功能（未来扩展）

---

## 3. 技术架构

### 3.1 技术栈
| 层级 | 技术选型 |
|------|----------|
| 前端 | Next.js 14+ (App Router) |
| 后端 | Python FastAPI |
| 数据库 | SQLite (初期) → PostgreSQL (扩展) |
| 文件存储 | 本地存储 (初期) → S3兼容存储 (扩展) |
| 任务队列 | Celery + Redis (用于异步视频生成) |

### 3.2 系统架构图
```
┌─────────────────────────────────────────────────────────┐
│                    前端 (Next.js)                        │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐       │
│  │ 剧本编辑 │ │ 角色管理 │ │ 分镜编辑 │ │ 视频预览 │       │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘       │
└─────────────────────────────────────────────────────────┘
                           │ API
                           ▼
┌─────────────────────────────────────────────────────────┐
│                   后端 (FastAPI)                         │
│  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐       │
│  │ 项目管理服务 │ │ AI调度服务   │ │ 素材管理服务 │       │
│  └─────────────┘ └─────────────┘ └─────────────┘       │
│  ┌─────────────────────────────────────────────┐       │
│  │              统一AI接口层                     │       │
│  │  ┌────┐ ┌────┐ ┌────┐ ┌────┐ ┌────┐        │       │
│  │  │可灵│ │通义│ │即梦│ │海螺│ │更多│        │       │
│  │  └────┘ └────┘ └────┘ └────┘ └────┘        │       │
│  └─────────────────────────────────────────────┘       │
└─────────────────────────────────────────────────────────┘
                           │
              ┌────────────┼────────────┐
              ▼            ▼            ▼
        ┌─────────┐  ┌─────────┐  ┌─────────┐
        │ SQLite  │  │  Redis  │  │文件存储  │
        └─────────┘  └─────────┘  └─────────┘
```

### 3.3 API设计原则
- RESTful API
- 统一的AI提供商接口抽象
- 支持WebSocket实时进度推送
- 异步任务处理

---

## 4. AI服务提供商接入

### 4.1 LLM（剧本生成）

| 提供商 | 模型 | 用途 | 状态 |
|--------|------|------|------|
| 阿里千问 | Qwen系列 | 剧本生成、分镜描述 | 待接入 |
| 字节豆包 | Doubao系列 | 剧本生成、分镜描述 | 待接入 |
| 智谱AI | GLM系列 | 剧本生成、分镜描述 | 待接入 |
| OpenAI | GPT-4系列 | 剧本生成、分镜描述 | 待接入 |
| Google | Gemini系列 | 剧本生成、分镜描述 | 待接入 |

### 4.2 图片生成

| 提供商 | 功能 | 主体参考 | 状态 |
|--------|------|----------|------|
| 可灵 | 文生图、图生图 | 待确认 | 待接入 |
| 通义万相 | 文生图、图生图 | 待确认 | 待接入 |
| 即梦AI | 文生图、图生图 | 待确认 | 待接入 |
| 海螺AI | 文生图、图生图 | 待确认 | 待接入 |

### 4.3 视频生成

| 提供商 | 图生视频 | 文生视频 | 主体参考 | 最大时长 | 状态 |
|--------|----------|----------|----------|----------|------|
| 可灵 | ✓ | ✓ | 待确认 | 待确认 | 待接入 |
| 通义万相 | ✓ | ✓ | 待确认 | 待确认 | 待接入 |
| 即梦AI | ✓ | ✓ | 待确认 | 待确认 | 待接入 |
| 海螺视频 | ✓ | ✓ | 待确认 | 待确认 | 待接入 |

---

## 5. 数据模型设计（初步）

### 5.1 核心实体
```
Project (项目)
├── Script (剧本)
│   └── Scene (场景)
│       └── Shot (镜头)
├── Character (角色)
│   └── CharacterImage (角色参考图)
├── Storyboard (故事板)
│   └── StoryboardFrame (故事板帧)
├── Video (视频片段)
└── Asset (素材)
```

### 5.2 主要表结构

#### projects
| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| name | String | 项目名称 |
| description | Text | 项目描述 |
| created_at | DateTime | 创建时间 |
| updated_at | DateTime | 更新时间 |

#### scripts
| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| project_id | UUID | 关联项目 |
| title | String | 剧本标题 |
| content | Text | 剧本内容(JSON结构化) |
| version | Integer | 版本号 |

#### characters
| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| project_id | UUID | 关联项目 |
| name | String | 角色名称 |
| description | Text | 外貌描述 |
| personality | Text | 性格特征 |
| prompt_keywords | Text | 用于提示词的关键词 |

#### shots
| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| scene_id | UUID | 关联场景 |
| order | Integer | 顺序 |
| description | Text | 镜头描述 |
| duration | Float | 时长(秒) |
| camera_movement | String | 镜头运动 |
| prompt | Text | 生成提示词 |

#### videos
| 字段 | 类型 | 说明 |
|------|------|------|
| id | UUID | 主键 |
| shot_id | UUID | 关联镜头 |
| provider | String | 生成平台 |
| status | String | 状态 |
| file_path | String | 文件路径 |
| generation_params | JSON | 生成参数 |

---

> 待收集信息、开发计划和待讨论问题请参见 [TODO.md](./TODO.md)

---

*文档版本: 1.0*
*最后更新: 2026-01-18*
